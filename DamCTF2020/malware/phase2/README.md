## malware/phase2
>Nice work finding that suspicious file! Using IcyRetina's extensive collection of Yara rules, you were able to identify that the sample is definitely malicious, but very little is known about it. Can you extract the config from the malware?

>There is a chunk of encrypted data that is accessed early on in the malware's execution. That is the the malware's config.

OpenSSL / libcrypto reference manual:
https://www.openssl.org/docs/man1.1.0/man3/EVP_CIPHER_CTX_new.html

* Initial triage: strings showing external calls to libcrypto and libc
* Binaryninja + Ghidra: Subroutine starting at 0x00102ece seems to be the subroutine for decrypting the config. Uses AES-256-CBC from OpenSSL/libcrypto

**Solution Script**
Implements the decryption routines.
* RC4 Key is stored at 0x4010 - 0x4030
* Encrypted Data is stored somewhere between 0x53A0 - 0x5BF6
* Encrypted Config Data is stored at 0x51A0 - 0x5397
* IV Config Value is stored at 0x4036 - 0x403A
* Key Config Value is stored at 0x403B - 0x403F


**Result of decrypting:**
* stky7a9d6fad3798a7867a9d6fad3798a786
* contbhuwehobiwsnbqpxnws.damctf.xyz
* jgiegoogle.com
* slti300
* xveefacebook.com
* flagdam{1m4g1n3_m4k1ng_w1nd0ws_m4lw4re_lma0}
* ehbnamazon.com
* bnwemicrosoft.com
* stivf83646fad02d42e6
* port3613
* IVnoopacknetwuserrunsruncdownupldexitr/etc/passwd/etc/shadow/etc/sudoers%s%s%sfailgoodwskip0123456789abcdefaaaaaaaa-aaaa-4aaa-baaa-aaaaaaaaaaaa/tmp/


Flag: `dam{1m4g1n3_m4k1ng_w1nd0ws_m4lw4re_lma0}`